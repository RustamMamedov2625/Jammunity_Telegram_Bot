package com.telegrambot.telegrambotjammunity.service;

import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import java.io.File;

/**
 * –°–ï–†–í–ò–° –î–õ–Ø –°–ö–ê–ß–ò–í–ê–ù–ò–Ø –í–ò–î–ï–û (–ó–ê–ì–û–¢–û–í–ö–ê –ù–ê –ë–£–î–£–©–ï–ï)
 *
 * –≠–¢–û–¢ –ö–õ–ê–°–° –ü–û–ö–ê –ù–ï –ê–ö–¢–ò–í–ï–ù - –æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ö–ê–ö –ú–û–ñ–ù–û
 * —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ, –µ—Å–ª–∏ —ç—Ç–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –≤ –±—É–¥—É—â–µ–º.
 *
 * –í–ê–ñ–ù–û: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ –º–æ–∂–µ—Ç –Ω–∞—Ä—É—à–∞—Ç—å —É—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
 * YouTube, TikTok –∏ –¥—Ä—É–≥–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!
 */
@Slf4j
@Service
public class VideoDownloadService {

    /**
     * –ó–ê–ì–û–¢–û–í–ö–ê –î–õ–Ø –°–ö–ê–ß–ò–í–ê–ù–ò–Ø –í–ò–î–ï–û
     *
     * –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –ü–û–ö–ê –ù–ï –†–ê–ë–û–¢–ê–ï–¢ - –æ–Ω –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.
     * –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ:
     * 1. –î–æ–±–∞–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è (youtube-dl, etc)
     * 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
     * 3. –†–µ—à–∏—Ç—å —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã
     */
    public File downloadVideo(String videoUrl) {
        log.warn("‚ö†Ô∏è  –ü–æ–ø—ã—Ç–∫–∞ —Å–∫–∞—á–∞—Ç—å –≤–∏–¥–µ–æ: {} - –§–£–ù–ö–¶–ò–Ø –ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê", videoUrl);

        // –ü–†–ò–ú–ï–† –±—É–¥—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
        /*
        try {
            // 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –≤–∏–¥–µ–æ –ø–æ URL
            String videoId = extractVideoId(videoUrl);

            // 2. –°–∫–∞—á–∏–≤–∞–µ–º –≤–∏–¥–µ–æ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
            File tempVideo = downloadToTempFile(videoUrl);

            // 3. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è Telegram
            File convertedVideo = convertForTelegram(tempVideo);

            log.info("‚úÖ –í–∏–¥–µ–æ —Å–∫–∞—á–∞–Ω–æ: {}", convertedVideo.getName());
            return convertedVideo;

        } catch (Exception e) {
            log.error("‚ùå –û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤–∏–¥–µ–æ: {}", videoUrl, e);
            return null;
        }
        */

        // –°–µ–π—á–∞—Å –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null - —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞
        return null;
    }

    /**
     * –û–¢–ü–†–ê–í–ö–ê –°–ö–ê–ß–ê–ù–ù–û–ì–û –í–ò–î–ï–û –í TELEGRAM
     *
     * –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ö–ê–ö –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–º.
     * –ù–æ —Å–µ–π—á–∞—Å –º—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ!
     */
    public void sendVideoAsFile(File videoFile, Long chatId,
                                org.telegram.telegrambots.meta.bots.AbsSender sender) {
        log.warn("‚ö†Ô∏è  –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–º - –§–£–ù–ö–¶–ò–Ø –ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê");

        // –ü–†–ò–ú–ï–† –±—É–¥—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
        /*
        SendVideo sendVideo = new SendVideo();
        sendVideo.setChatId(chatId.toString());
        sendVideo.setVideo(new InputFile(videoFile));
        sendVideo.setCaption("üìπ –í–∏–¥–µ–æ (—Å–∫–∞—á–∞–Ω–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞)");

        sender.execute(sendVideo);
        */
    }

    /**
     * –ü–†–û–í–ï–†–Ø–ï–¢, –ú–û–ñ–ù–û –õ–ò –°–ö–ê–ß–ê–¢–¨ –í–ò–î–ï–û –° –î–ê–ù–ù–û–ô –ü–õ–ê–¢–§–û–†–ú–´
     */
    public boolean canDownloadFromPlatform(String videoUrl) {
        // –ü–æ–∫–∞ –∑–∞–ø—Ä–µ—â–∞–µ–º —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
        return false;
    }
}